# Maintainer: shivanandvp <shivanandvp@rebornos.org>

pkgname=calamares-core
pkgver=0.0.1
pkgrel=1
arch=('i686' 'x86_64' 'armv6h' 'armv7h')
pkgdesc='Calamares Installer for RebornOS. This is practically just bare Calamares. Please also install rebornos-calamares-configuration.'
license=('GPL3')
depends=('qt5-svg'
         'qt5-xmlpatterns'
         'qt5-location' 
         'kconfig'
         'ki18n'
         'kcoreaddons'
         'solid'
         'kpackage'
         'plasma-framework'
         'yaml-cpp'
         'parted'
         'libatasmart'
         'udisks2'
         'polkit-qt5'
         'kpmcore'
         'kparts'
         'kdbusaddons'
         'libpwquality'
         'boost'
         'boost-libs'
         'calamares-configuration'
         'calamares-branding')
optdepends=()
makedepends=('extra-cmake-modules'
             'git'
             'qt5-tools') 
provides=("${pkgname}")
conflicts=("${pkgname}")
source=()
replaces=('calamares'
          'calamares-core')

PROJECT_DIRECTORY="$(dirname -- "$(dirname -- "$(pwd)")")"
BUILD_DIRECTORY="$PROJECT_DIRECTORY/build"
RESOURCE_DIRECTORY="$PROJECT_DIRECTORY/rebornos_scripts/archlinux_packaging"
NUMBER_OF_PROCESSORS="$(nproc)"

prepare() {
    cp "$RESOURCE_DIRECTORY/rebornos-calamares.desktop" "${srcdir}"
    cp "$RESOURCE_DIRECTORY/rebornos-calamares.png" "${srcdir}"
    cp "$RESOURCE_DIRECTORY/rebornos-calamares.svg" "${srcdir}"
}

build() {     
    mkdir -p "$BUILD_DIRECTORY" && \
    cmake \
        -DCMAKE_BUILD_TYPE=Debug \
        -DCMAKE_INSTALL_PREFIX=/usr \
        -DCMAKE_INSTALL_LIBDIR=lib \
        -B "$BUILD_DIRECTORY" -S "$PROJECT_DIRECTORY" && \
    cmake --build "$BUILD_DIRECTORY" --parallel "$NUMBER_OF_PROCESSORS"
}

package() {
    DESTDIR="${pkgdir}" cmake --install "$BUILD_DIRECTORY"
    install -Dm 755 "${srcdir}/rebornos-calamares.desktop" "${pkgdir}/usr/share/applications/rebornos-calamares.desktop"
    install -Dm 755 "${srcdir}/rebornos-calamares.svg" "${pkgdir}/usr/share/pixmaps/rebornos-calamares.svg"
}